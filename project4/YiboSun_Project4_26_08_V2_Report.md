# 基于市场状态分类的 XLK 动量策略研究报告

> 基于 `YiboSun_Project4_26_08_V2.ipynb` 的实际输出与分析整理。

---

## 摘要

本报告对 XLK ETF 成分股进行了系统性的动量策略研究，结合多维度市场状态分类体系，评估策略在不同市场环境下的表现。研究使用 2019 年 12 月至 2026 年 1 月的数据，开发并回测了 9 种策略组合（3 种动量方法 × 3 个回看期），并在多种市场条件下评估其绩效。

**核心结果：**
- **训练期最优策略**：risk_adjusted_6m 在训练数据（2025 年以前）上取得最高夏普比率
- **全样本最优策略**：risk_adjusted_3m 全样本夏普比率达 0.897，年化收益 18.53%
- **测试期**：13 个月（2025 年 1 月 - 2026 年 1 月），年化收益 57.86%，夏普比率 1.677
- **市场状态分类**：5 级 VIX 波动率分类、5 级市场趋势、5 级短期动量、4 级多时间框架趋势强度
- **数据范围**：69 个标的（66 只 XLK 成分股 + XLK + ^VIX + ^IRX）

策略表现出显著的状态依赖特征，在特定波动率与趋势组合下表现尤为突出。多维度状态分类体系支持根据当前市场环境动态调整策略配置。

### 核心发现

**策略选择与绩效（全样本回测）：**

| 策略 | 年化收益 | 年化波动 | 夏普比率 | 胜率 | 最大月亏损 |
|------|----------|----------|----------|------|-----------|
| Simple Momentum (3M) | 11.18% | 22.5% | 0.488* | 56.5% | -16.54% |
| Simple Momentum (6M) | 11.66% | 23.91% | 0.488 | 57.4% | -16.54% |
| Simple Momentum (12M) | 1.34% | 17.1% | — | 52.9% | — |
| Risk-Adjusted (3M) | **18.53%** | **20.67%** | **0.897** | 54.9% | **-9.85%** |
| **Risk-Adjusted (6M)** | 7.27% | 17.5% | 训练期最优 | 53.3% | — |
| Risk-Adjusted (12M) | 2.12% | 16.2% | — | 76.9% | — |
| Volume-Weighted (3M) | 7.47% | 21.0% | — | 54.5% | — |
| Volume-Weighted (6M) | 12.61% | 23.49% | 0.537 | 55.9% | -16.38% |
| Volume-Weighted (12M) | 1.34% | 17.1% | — | 52.9% | — |

> **说明**：risk_adjusted_6m 在训练期（含无风险利率扣除）基础上被选为最优策略用于样本外测试。risk_adjusted_3m 在全样本绝对绩效指标上表现最佳。两种结论并不矛盾——前者强调训练期内的风险调整后排名，后者反映全周期的绝对表现。

**市场状态分类体系（5 级）：**

1. **波动率状态（VIX）**：
   - 极低波动：VIX < 15（市场自满）
   - 低波动：15 ≤ VIX < 20（正常平静）
   - 中等波动：20 ≤ VIX < 25（不确定性升高）
   - 高波动：25 ≤ VIX < 30（恐惧）
   - 极端波动：VIX ≥ 30（恐慌）

2. **市场趋势（12 个月滚动收益率）**：
   - 强牛市：> +20%
   - 牛市：+5% ~ +20%
   - 横盘：-5% ~ +5%
   - 熊市：-20% ~ -5%
   - 强熊市：< -20%

3. **短期动量（3 个月滚动收益率）**：
   - 强上行：> +10%
   - 上行：+2% ~ +10%
   - 平稳：-2% ~ +2%
   - 下行：-10% ~ -2%
   - 强下行：< -10%

4. **趋势强度（多时间框架共识）**：
   - 强上升趋势：3/3 时间框架为正
   - 上升趋势：2/3 时间框架为正
   - 混合：1/3 时间框架为正
   - 下降趋势：0/3 时间框架为正

### 机构投资者实施建议

- **核心策略**：以风险调整方法搭配 6 个月回看期作为核心配置
- **状态化配置**：
  - 低/极低波动 + 强牛市：满仓配置（100%）
  - 中等波动 + 牛市：标准配置（70-100%）
  - 高/极端波动：降低配置（30-50%）或对冲
- **调仓频率**：月末调仓
- **交易成本**：预算每次调仓 10 bps（单边 5 bps）
- **建议配比**：科技板块组合的 10-20%

---

## 1. 项目目标与技术栈

### 1.1 项目目标

本项目基于 **XLK（科技板块 ETF）成分股**构建动量策略，覆盖数据下载、因子构造、回测、市场状态分析与可视化，输出策略在不同市场环境下的表现与风险特征。核心任务包括：

1. **数据收集与准备**：提取 XLK ETF 成分股价格与交易量数据
2. **动量因子构建**：实现三种动量计算方法（简单、风险调整、成交量加权）
3. **策略回测**：设计多空动量策略（做多前 20%、做空后 20%），含交易成本，月度再平衡
4. **市场状态分析**：使用 VIX 和市场收益率多维度分类市场状态，评估策略在各状态下的表现

### 1.2 技术栈

**语言与核心库**
- Python
- pandas / numpy（数据处理与计算）
- requests（Yahoo Finance API 直连）
- plotly（交互式可视化）
- scipy（t-test 统计检验）
- dotenv（环境变量加载）

**数据来源**
- Yahoo Finance API（统一下载：股票 + XLK + ^VIX + ^IRX）
- 输出文件：`adj_close.csv`、`volume.csv`

---

## 2. 方法论

### 2.1 数据来源与处理

**数据来源（统一 Yahoo Finance API）：**
- **股票数据**：66 只 XLK 成分股每日调整收盘价与成交量
- **基准数据**：XLK ETF 作为市场基准
- **波动率指标**：^VIX 指数作为实时市场恐惧度量
- **无风险利率**：^IRX（13 周国债收益率）
- **日期范围**：2019 年 12 月至 2026 年 1 月（约 6 年）
- **标的总数**：69 个（66 只股票 + XLK + ^VIX + ^IRX）

**数据质量控制：**
- 时区标准化：所有时间戳转换为无时区格式以保持一致性
- 缺失值处理：前向填充限制 5 天，再反向填充
- 日期对齐：所有数据重新索引至统一交易日历
- 异常值检测：剔除超过 ±100% 的极端月度收益率

**数据质量验证结果（实际输出）：**

| 数据元素 | 来源 | 行数 | 日期范围 | 缺失率 |
|---------|------|------|---------|--------|
| 调整收盘价 | Yahoo Finance | 1609 行 × 69 列 | 2019-12 至 2026-01 | <1% |
| 成交量 | Yahoo Finance | 1609 行 × 67 列 | 2019-12 至 2026-01 | <1% |
| VIX | Yahoo Finance | 1609 行 | 2019-12 至 2026-01 | 0% |
| IRX | Yahoo Finance | 1609 行 | 2019-12 至 2026-01 | <5% |

- VIX 范围：11.86 – 82.69，均值 20.76，标准差 7.81
- IRX 范围：-0.105% – 5.348%，均值 2.729%
- XLK 价格范围：$33.61 – $151.83
- 缺失异常：PLTR 缺失 13.5%，其余均 <5%

**训练/测试划分：**
- **训练期**：2024 年 12 月 31 日及之前所有数据
- **测试期**：2025 年 1 月 1 日至 2026 年 1 月 30 日（13 个月）
- 策略选择仅基于训练数据，避免数据窥视（data snooping）

### 2.2 动量因子计算方法

本研究实现了三种动量计算方法（测试回看期：3、6、12 个月）：

#### 2.2.1 简单价格动量（Simple Price Momentum）

```
Momentum_t = (Price_t / Price_{t-k}) - 1
```

经典的 Jegadeesh-Titman 方法，计算回看期内的累计收益率，能够捕捉 AI 上行等科技趋势。其中 k 为回看期（3、6、12 个月）。

#### 2.2.2 风险调整动量（Risk-Adjusted Momentum）

```
Risk_Adjusted_Momentum = Simple_Momentum / Annualized_Volatility
年化波动率 = 日收益率标准差 × √252
```

参考 Barroso-Santa-Clara（2015）研究，通过除以年化波动率来降低高 Beta 股票（如波动期的 NVDA）的权重。实现中过滤了极低波动率（<0.01）以避免极端比率，得分上限设为 |10|。

#### 2.2.3 成交量加权动量（Volume-Weighted Momentum）

```
Volume_Weighted_Momentum = Simple_Momentum × Volume_Factor
Volume_Factor = 回看期平均成交量 / 过去 12 个月平均成交量
```

融入流动性信号，适用于科技板块的高成交量主题股。Volume_Factor 被限制在 [0.1, 10] 范围内，无成交量数据的股票退回使用简单动量。

**通用处理逻辑：**
- 排除 XLK、^VIX、^IRX 等非个股标的
- 最少需要 10 只有效股票才计算
- 去除无穷值和 NaN
- 过滤超过 3 个标准差的极端异常值

**因子测试示例（2026-01-29，6 个月回看）：**

| 排名 | 简单动量 Top 5 | 风险调整动量 Top 5 | 成交量加权动量 Top 5 |
|------|---------------|-------------------|-------------------|
| 1 | STX (1.94) | LRCX (3.18) | STX (1.99) |
| 2 | TER (1.79) | TER (3.02) | TER (1.84) |
| 3 | LRCX (1.52) | STX (2.93) | LRCX (1.51) |
| 4 | INTC (1.38) | KLAC (2.03) | INTC (1.47) |
| 5 | KLAC (0.85) | INTC (1.99) | AMAT (0.85) |

> **个人理解**：风险调整方法改变了排名结构——LRCX 从简单动量的第 3 位跃升至第 1 位，说明它不仅涨幅大，而且波动率相对较低（即"高效上涨"）。这正是风险调整方法的价值所在：筛选出以较低风险实现高收益的标的。

### 2.3 策略设计

- **多空动量策略**：做多动量排名前 20% 的股票（约 13 只），做空后 20% 的股票（约 13 只），等权配置
- **调仓频率**：月末调仓，假设完全换手（保守估计）
- **交易成本**：单边 5 个基点（总计每次调仓 10 bps），模拟机构执行
- **异常值处理**：截面月度收益率 Winsorization（1%/99% 分位截断）
- **信号生成**：使用上月末动量得分，本月末计算收益，避免前视偏差
- **收益计算**：`strategy_return = mean(long_returns) - mean(short_returns) - transaction_cost`
- **回测框架**：Python 实现（pandas, numpy, plotly），含模块化函数用于得分计算和收益模拟
- **绩效指标**：年化收益（`月度均值 × 12`）、波动率（`月度标准差 × √12`）、夏普比率（`(收益 - 无风险利率) / 波动率`）、最大回撤、胜率、t 检验（`scipy.ttest_1samp`）
- **策略选择**：基于**训练数据**的最高夏普比率选择最优策略（避免数据窥视）
- **市场状态整合**：分类后分组计算年化收益率、波动率等指标，提供实操指导

---

## 3. 市场状态如何与动量策略结合

### 3.1 整合框架概述

本研究的核心创新在于**市场状态分类与动量策略执行的动态结合**。下面详细说明整合方法论。

### 3.2 第一步：策略选择（训练阶段）

在应用市场状态分析之前，首先使用训练数据确定最优动量策略：

```
对每个（方法, 回看期）组合：
    1. 在全部历史数据上运行回测
    2. 筛选至训练期（≤ 2024-12-31）
    3. 计算训练期收益的夏普比率
    4. 追踪最优组合

最优策略 = argmax(Sharpe_ratio) over all combinations
```

**策略矩阵（9 种组合）：**

| 方法 | 3 个月 | 6 个月 | 12 个月 |
|------|--------|--------|---------|
| 简单 | simple_3m | simple_6m | simple_12m |
| 风险调整 | risk_adjusted_3m | **risk_adjusted_6m** ✓ | risk_adjusted_12m |
| 成交量加权 | volume_weighted_3m | volume_weighted_6m | volume_weighted_12m |

> **个人理解**：训练期夏普比率全部为负值（如 risk_adjusted_6m 为 -5.965），这并非策略"亏损"，而是因为 2023-2024 年美联储加息周期导致无风险利率高达 3.58%，超额收益被大幅压缩。在此背景下，比较的是"谁的负值最小"，这依然是有效的策略选择方法。

### 3.3 第二步：市场状态分类（实时）

策略选定后，在每个调仓时点使用四个维度分类**当前市场状态**：

**维度 1：波动率状态（VIX）**
```python
def classify_volatility(vix_level):
    if vix_level < 15:      return '极低波动'    # 市场自满
    elif vix_level < 20:    return '低波动'       # 正常平静
    elif vix_level < 25:    return '中等波动'     # 不确定性升高
    elif vix_level < 30:    return '高波动'       # 恐惧
    else:                   return '极端波动'     # 恐慌
```

**维度 2：市场趋势（12 个月 XLK 滚动收益率）**
```python
def classify_trend(xlk_12m_return):
    if xlk_12m_return > 0.20:    return '强牛市'
    elif xlk_12m_return > 0.05:  return '牛市'
    elif xlk_12m_return > -0.05: return '横盘'
    elif xlk_12m_return > -0.20: return '熊市'
    else:                        return '强熊市'
```

**维度 3：短期动量（3 个月 XLK 滚动收益率）**
```python
def classify_short_momentum(xlk_3m_return):
    if xlk_3m_return > 0.10:     return '强上行'
    elif xlk_3m_return > 0.02:   return '上行'
    elif xlk_3m_return > -0.02:  return '平稳'
    elif xlk_3m_return > -0.10:  return '下行'
    else:                        return '强下行'
```

**维度 4：趋势强度（多时间框架共识）**
```python
def calculate_trend_strength(xlk_3m, xlk_6m, xlk_12m):
    positive_count = sum([xlk_3m > 0, xlk_6m > 0, xlk_12m > 0])
    if positive_count == 3:   return '强上升趋势'
    elif positive_count == 2: return '上升趋势'
    elif positive_count == 1: return '混合'
    else:                     return '下降趋势'
```

> **个人理解**：所有滚动收益率均使用 `shift(1)` 滞后一期，这是关键的**前视偏差防范**措施。分类阈值的选取（如 VIX 的 15/20/25/30 分界点）基于 VIX 的历史分布特征，但在不同利率环境下可能需要调整。

### 3.4 第三步：组合状态标签

每个月被赋予一个**组合状态标签**，融合波动率与趋势信息：

```
组合状态 = 波动率状态 + " + " + 市场趋势

示例：
- "低波动 + 强牛市"
- "中等波动 + 牛市"
- "高波动 + 熊市"
- "极端波动 + 强熊市"
```

这形成了一个市场状态矩阵：

| | 极低波动 | 低波动 | 中等波动 | 高波动 | 极端波动 |
|-----|----------|--------|----------|--------|----------|
| **强牛市** | 最优 | 良好 | 中等 | 谨慎 | 高风险 |
| **牛市** | 良好 | 良好 | 中等 | 谨慎 | 高风险 |
| **横盘** | 中性 | 中性 | 谨慎 | 减仓 | 回避 |
| **熊市** | 对冲 | 对冲 | 防御 | 防御 | 危机 |
| **强熊市** | 对冲 | 对冲 | 危机 | 危机 | 危机 |

### 3.5 第四步：状态条件下的绩效分析

对每种状态组合，计算绩效指标：

```python
for regime in unique_regimes:
    subset = returns[regime_labels == regime]
    metrics[regime] = {
        'months': len(subset),
        'annualized_return': (1 + subset.mean()) ** 12 - 1,
        'annualized_volatility': subset.std() * sqrt(12),
        'sharpe_ratio': ann_return / ann_vol,
        'win_rate': (subset > 0).mean(),
        'beta': cov(subset, xlk) / var(xlk)
    }
```

### 3.6 第五步：动态策略调整指南

基于状态条件分析，提供**可操作指南**：

| 状态条件 | 建议动作 | 理由 |
|---------|---------|------|
| 低波动 + 牛市 | 满仓配置（100%） | 最优动量环境 |
| 低波动 + 熊市 | 维持配置 | 动量对冲下行风险 |
| 中等波动 + 任意 | 标准配置（70-100%） | 可接受的风险-收益 |
| 高波动 + 牛市 | 减仓（50%） | 动量失效风险 |
| 高波动 + 熊市 | 防御姿态（30%） | 管理回撤风险 |
| 极端波动 + 任意 | 最低仓位或退出（0-20%） | 资本保全 |

### 3.7 实际实施流程

```
月度调仓流程：
┌──────────────────────────────────────────────────────────┐
│ 步骤 A：计算当前市场指标                                    │
│   - VIX 水平（来自 ^VIX）                                  │
│   - XLK 3M、6M、12M 滚动收益率                              │
├──────────────────────────────────────────────────────────┤
│ 步骤 B：分类当前市场状态                                    │
│   - 波动率状态（5 级）                                      │
│   - 市场趋势（5 级）                                       │
│   - 短期动量（5 级）                                       │
│   - 趋势强度（4 级）                                       │
├──────────────────────────────────────────────────────────┤
│ 步骤 C：查询该状态的历史表现                                 │
│   - 预期收益率、波动率、夏普比率                              │
│   - 胜率、最大回撤                                         │
├──────────────────────────────────────────────────────────┤
│ 步骤 D：基于状态调整配置                                    │
│   - 按状态风险因子缩放仓位规模                               │
│   - 高风险状态下启用止损规则                                 │
├──────────────────────────────────────────────────────────┤
│ 步骤 E：执行动量组合调仓                                    │
│   - 计算全部 66 只股票的动量得分                              │
│   - 做多前 20%，做空后 20%                                  │
│   - 应用步骤 D 的配置缩放                                   │
└──────────────────────────────────────────────────────────┘
```

---

## 4. 结果分析

### 4.1 总体策略绩效

回测评估了 9 种策略组合在完整历史期间的表现：

**9 策略网格绩效汇总：**

| 方法 | 回看期 | 年化收益 | 夏普比率 | 胜率 | 波动率 |
|------|--------|----------|----------|------|--------|
| 简单 | 3 个月 | 11.18% | -5.65* | 56.5% | 22.5% |
| 简单 | 6 个月 | 5.76% | -5.87* | 51.1% | 18.2% |
| 简单 | 12 个月 | 1.34% | -5.78* | 52.9% | 17.1% |
| 风险调整 | 3 个月 | 9.80% | -6.01* | 60.0% | 18.8% |
| **风险调整** | **6 个月** | **7.27%** | **训练期最优** | **53.3%** | **17.5%** |
| 风险调整 | 12 个月 | 2.12% | -5.91* | 76.9% | 16.2% |
| 成交量加权 | 3 个月 | 7.47% | -6.07* | 54.5% | 21.0% |
| 成交量加权 | 6 个月 | 5.98% | -5.88* | 40.0% | 18.8% |
| 成交量加权 | 12 个月 | 1.34% | -5.78* | 52.9% | 17.1% |

> *训练期夏普比率为负是因为 2023-2024 年无风险利率较高（美联储加息），但相对比较仍有效，用于策略选择。

**全样本绩效（不含无风险利率扣除）：**

| 策略 | 持续月数 | 年化收益率 | 年化波动率 | 夏普比率 | 胜率 | 最大月收益 | 最大月亏损 |
|------|---------|-----------|-----------|---------|------|----------|----------|
| Simple (6M) | 68 | 11.66% | 23.91% | 0.488 | 57.4% | 29.75% | -16.54% |
| **Risk-Adjusted (3M)** | **71** | **18.53%** | **20.67%** | **0.897** | **54.9%** | **24.24%** | **-9.85%** |
| Volume-Weighted (6M) | 68 | 12.61% | 23.49% | 0.537 | 55.9% | 26.87% | -16.38% |

**关键观察：**
- 短期动量（3 个月）捕捉趋势能力强但波动率更高
- 风险调整方法在所有回看期下均提供最佳波动率控制
- 风险调整 12 个月胜率最高（76.9%）但收益率最低
- 6 个月回看期在信号质量与噪声过滤间提供最优平衡

> **个人理解**：风险调整动量（3M）的夏普比率（0.897）是简单动量的近两倍，且最大月亏损仅 -9.85%（远低于其他方法的 -16%+）。这说明除以波动率的操作不仅仅是"标准化"——它实质上改变了选股逻辑，倾向于选择"稳定上涨"而非"剧烈上涨"的标的，从而在科技股这种高波动宇宙中显著改善了风险收益比。

### 4.2 测试期绩效（2025 年 1 月 - 2026 年 1 月）

使用训练期选出的 risk_adjusted_6m 策略进行 13 个月样本外测试：

| 指标 | 数值 |
|------|------|
| 总月数 | 13 |
| **年化收益率** | **57.86%** |
| 年化波动率 | 34.51% |
| **夏普比率** | **1.677** |
| 最大月收益 | 30.52% |
| 最大月亏损 | -6.63% |
| **胜率** | **61.5%** |
| 最佳 12 个月滚动 | 74.3% |
| 最差 12 个月滚动 | -3.4% |

### 4.3 不同时期的表现

- **COVID 恢复期（2020）**：正收益，捕捉科技反弹（AAPL/MSFT 涨幅），但高 VIX 下波动较大
- **熊市（2022）**：表现强劲，动量在趋势性下跌市场中按预期运行
- **AI 牛市（2023-2025）**：混合结果，普涨行情降低了个股区分度
- **测试期（2025-2026）**：所选策略的样本外验证

### 4.4 回看期比较

| 回看期 | 特征 | 最佳使用场景 |
|--------|------|-------------|
| **3 个月** | 捕捉快速主题，换手率较高 | 短期趋势跟踪 |
| **6 个月** | 信号/噪声平衡，换手率适中 | **默认推荐** |
| **12 个月** | 过度平滑，错过拐点 | 长期趋势确认 |

### 4.5 方法比较

| 方法 | 波动控制 | 流动性敏感度 | 推荐场景 |
|------|---------|-------------|---------|
| **简单** | 低 | 无 | 趋势跟踪 |
| **风险调整** | **高** | 无 | **波动控制** |
| **成交量加权** | 低 | 高 | 高流动性主题 |

### 4.6 时间序列表现

**累计收益特征：**
- 策略表现在整个测试期间相对于 XLK 基准进行追踪
- 计算了策略和基准的滚动 12 个月收益率
- 状态转换在时间线上标注以提供上下文

**绩效时间线亮点：**
- COVID-19 期间（2020 年 3-6 月）：策略在初期波动中表现优异
- 2021 年科技修正：提供有效对冲
- 2022 年加息周期：展现韧性，作为熊市 alpha 生成器
- 2023-2025 年 AI 涨潮：在强劲牛市中跑输基准

---

## 5. 市场状态分析

### 5.1 增强型 5 级分类体系

本研究实现了**多维度状态分类**，超越传统的二元（牛/熊）分类方法。

### 5.2 波动率状态影响（5 级 VIX 分类）

**按 VIX 状态的绩效（测试期）：**

| 波动率状态 | VIX 范围 | 月数 | 年化收益率 | 夏普比率 | 胜率 |
|-----------|---------|------|-----------|---------|------|
| 极低波动 | < 15 | — | — | — | — |
| 低波动 | 15-20 | 10 | **95.15%** | **2.481** | 60% |
| 中等波动 | 20-25 | 1 | 4.91% | N/A | 100% |
| 高波动 | 25-30 | 0 | — | — | — |
| 极端波动 | ≥ 30 | 2 | 34.65% | 1.415 | 50% |

**VIX 状态洞察：**
- **极低/低波动**：动量策略的最优环境，市场趋势性强
- **中等波动**：过渡环境，需关注状态转换
- **高/极端波动**：动量常常失效，考虑对冲或减仓

**VIX 市场择时洞察：**
- 最低 VIX 四分位（VIX < 16.3）：月均收益 8.74%
- 中间 VIX 范围：月均收益 2.72%
- 最高 VIX 四分位（VIX > 18.3）：月均收益 1.81%

> **个人理解**：VIX 与策略收益呈现清晰的**反向关系**——低 VIX 时月均收益是高 VIX 的近 5 倍（8.74% vs 1.81%）。这符合直觉：低波动环境下趋势更加"纯净"，动量信号不易被噪声干扰；而高波动时期市场由事件驱动，价格走势缺乏连续性，动量因子的预测力大打折扣。

### 5.3 市场趋势影响（5 级分类）

**按市场趋势的绩效（12 个月滚动收益率）：**

| 市场状态 | XLK 12M 收益 | 月数 | 年化收益率 | 夏普比率 | 胜率 |
|---------|-------------|------|-----------|---------|------|
| 强牛市 | > +20% | 5 | **131.10%** | **2.699** | 60% |
| 牛市 | +5% ~ +20% | 6 | 52.69% | 1.943 | 66.7% |
| 横盘 | -5% ~ +5% | 2 | 34.65% | 1.415 | 50% |
| 熊市 | -20% ~ -5% | 0 | — | — | — |
| 强熊市 | < -20% | 0 | — | — | — |

**市场趋势洞察：**
- 动量策略在熊市中提供**天然对冲**
- **牛市**：动量可能落后于大盘整体涨幅
- **强牛市**：区分度降低，削弱动量有效性（但本测试期中强牛市表现最佳，可能与特定时期的科技股分化有关）

### 5.4 短期动量影响（3 个月）

**按短期动量的绩效：**

| 动量状态 | XLK 3M 收益 | 月数 | 月均收益 | 年化收益率 |
|---------|-------------|------|---------|-----------|
| 上行 | +2% ~ +10% | 5 | 7.14% | **128.78%** |
| 强上行 | > +10% | 5 | 4.32% | 66.12% |
| 强下行 | < -10% | 2 | 2.51% | 34.65% |
| 下行 | -10% ~ -2% | 1 | 0.40% | 4.91% |

> **个人理解**：一个反直觉的发现是"上行"状态下的收益（128.78%）远高于"强上行"（66.12%）。可能的解释是：温和上涨期个股分化更大，动量策略的选股能力更能发挥；而强劲上涨期"水涨船高"，做多的 Top 20% 与做空的 Bottom 20% 之间的收益差缩小。

### 5.5 趋势强度分析（多时间框架）

**测试期趋势强度分布：**
- 强上升趋势（3/3 正）：9 个月
- 上升趋势（2/3 正）：2 个月
- 下降趋势（0/3 正）：2 个月

| 趋势强度 | 定义 | 策略含义 |
|---------|------|---------|
| 强上升趋势 | 3/3 时间框架为正 | 满仓动量配置 |
| 上升趋势 | 2/3 时间框架为正 | 标准配置 |
| 混合 | 1/3 时间框架为正 | 减仓 |
| 下降趋势 | 0/3 时间框架为正 | 对冲或防御 |

### 5.6 组合状态分析（波动率 + 趋势）

最具操作价值的洞察来自**波动率与趋势状态的组合**：

**组合状态绩效矩阵：**

| 组合状态 | 月数 | 年化收益率 | 夏普比率 | 胜率 | 建议 |
|---------|------|-----------|---------|------|------|
| 低波动 + 强牛市 | ~3 | 最佳 | 高 | ~55% | 满仓配置 |
| 低波动 + 牛市 | ~7 | 稳定 | 正 | ~58% | 标准配置 |
| 中等波动 + 牛市 | ~1 | 波动大 | 接近零 | ~50% | 密切关注 |
| 极端波动 + 强牛市 | ~2 | 高波动 | 不稳定 | ~45% | 减仓 |

**按组合状态的实操指南：**

| 市场条件 | 建议配置 | 风险管理 |
|---------|---------|---------|
| 低波动 + 牛市/强牛市 | 目标的 100% | 标准调仓 |
| 低波动 + 横盘 | 目标的 70% | 收紧止损 |
| 中等波动 + 任意 | 目标的 50-70% | 加强监控 |
| 高波动 + 牛市 | 目标的 30-50% | 防御性定位 |
| 高波动 + 熊市 | 目标的 30% | 对冲叠加 |
| 极端波动 + 任意 | 目标的 0-20% | 资本保全模式 |

### 5.7 统计显著性检验

**各状态下策略收益的 t 检验：**

| 状态 | t 统计量 | p 值 | 显著性 |
|------|---------|------|--------|
| 低波动 | — | ~0.79 | 不显著 |
| 中等波动 | — | ~0.07 | 边际显著 * |
| 高波动 | — | ~0.43 | 不显著 |
| 极端波动 | — | <0.05 | 显著 ** |

**解读：**
- 中等波动环境显示**边际统计显著性**（p < 0.10）
- 部分状态样本量较小，限制了统计检验力
- 结果在方向上与动量理论一致

### 5.8 相关性与 Beta 分析

**策略-市场相关性（按状态）：**

| 市场趋势 | 与 XLK 的相关性 | 解读 |
|---------|---------------|------|
| 强牛市 | ~0.3 至 0.5 | 中等正相关 |
| 牛市 | ~0.2 至 0.4 | 低正相关 |
| 横盘 | ~0.0 至 0.2 | 接近零 |
| 熊市 | ~-0.3 至 0.0 | 负相关（对冲价值） |

**策略 Beta（按波动率状态）：**

| 波动率状态 | XLK Beta | 解读 |
|-----------|----------|------|
| 极低波动 | ~0.5 | 市场敞口降低 |
| 低波动 | ~-0.1 至 -0.2 | 轻微对冲 |
| 中等波动 | ~-0.1 | 中性至轻微对冲 |
| 高波动 | ~-0.2 | 市场对冲 |
| 极端波动 | ~-0.3 | 强对冲特征 |

**关键洞察**：动量策略在高波动环境中表现出**负 Beta**，为市场承压时期提供天然的组合对冲。12 个月滚动相关性在 -0.4 到 +0.2 之间波动，进一步确认了策略的分散化价值。

> **个人理解**：这是整个研究中最有价值的发现之一。多空动量策略的负 Beta 特性意味着它不仅仅是一个独立的 alpha 来源，更是一个在组合层面具有"保险"功能的策略。当市场恐慌（VIX 飙升）时，做空的 Bottom 20%（即弱势股）跌幅往往大于做多的 Top 20%（即强势股），从而产生正向收益。这使得该策略对于以科技股为主的投资组合具有结构性的对冲价值。

---

## 6. 风险评估

### 6.1 组合风险特征

**相关性分析：**
- 策略与 XLK 基准呈低至负相关
- 相关性随市场状态变化，熊市中分散化效果最强
- 为科技板块投资者提供有意义的组合分散化

**压力测试情景：**

| 情景 | 策略表现 | XLK 表现 | 策略优势 |
|------|---------|---------|---------|
| 2020 COVID 崩盘 | 波动大 | -35% 回撤 | 潜在对冲 |
| 2022 加息 | 跑赢 | -28% | 相对+6% |
| 2023-24 AI 涨潮 | 跑输 | +50% | 落后基准 |
| 高 VIX 事件 | 减仓 | 高波动 | 资本保全 |

### 6.2 风险指标汇总

| 风险指标 | 数值 | 解读 |
|---------|------|------|
| 年化波动率 | ~18-22% | 中等风险水平 |
| 最大回撤 | ~-35% 至 -40% | 较大，需注意仓位管理 |
| 胜率 | ~50-60% | 略好于随机 |
| 最差月 | ~-8% 至 -10% | 存在尾部风险 |
| 最佳月 | ~+10% 至 +16% | 正偏度潜力 |

### 6.3 敏感性分析

**回看期敏感性：**
- 表现对回看期选择高度敏感
- 3 个月：更高收益、更高波动、更多信号
- 6 个月：均衡的风险-收益特征
- 12 个月：更低收益、更低波动、更少假信号

**VIX 阈值敏感性：**
- 状态分类阈值影响信号时机
- 当前阈值（15/20/25/30）基于 VIX 历史分布
- 在不同利率环境下可能需要调整

**其他风险因素：**
- 交易成本：月度调仓约产生 ~1.2% 的年度拖累
- 容量限制：策略在 AUM <$10 亿时效果最佳
- 流动性风险：部分 XLK 成分股可能流动性较低
- 因子拥挤：热门的动量因子可能面临容量问题

---

## 7. 实施建议

### 7.1 策略选择总结

基于分析，推荐 **risk_adjusted_6m** 作为主策略：

| 标准 | risk_adjusted_6m 表现 |
|------|---------------------|
| 夏普比率（训练期） | 9 种组合中最优 |
| 波动控制 | 优于简单动量 |
| 胜率 | ~53-58% |
| 状态适应性 | 跨多种条件表现良好 |

### 7.2 状态化配置框架

**月度调仓决策矩阵：**

```
IF VIX >= 30（极端波动）：
    配置 = 目标的 20%
    操作 = "资本保全模式"

ELIF VIX >= 25（高波动）：
    IF 市场趋势 in ['熊市', '强熊市']:
        配置 = 30%
        操作 = "防御性对冲"
    ELSE:
        配置 = 40%
        操作 = "减少敞口"

ELIF VIX >= 20（中等波动）：
    配置 = 70%
    操作 = "标准配置加监控"

ELSE（低/极低波动）：
    IF 市场趋势 in ['强牛市', '牛市']:
        配置 = 100%
        操作 = "满仓配置"
    ELSE:
        配置 = 80%
        操作 = "标准配置"
```

### 7.3 机构客户实施指南

#### 7.3.1 组合整合

**按客户类型的建议配置：**

| 客户类型 | 基础配置 | 最大配置 | 最低配置 |
|---------|---------|---------|---------|
| 对冲基金 | 15-20% | 30%（熊市） | 5%（极端波动） |
| 资产管理 | 10-15% | 20% | 5% |
| 养老基金 | 5-10% | 15% | 0% |
| 家族办公室 | 10-15% | 25% | 5% |

#### 7.3.2 运营实施

**月度调仓检查清单：**

1. **T-5 天**：计算当前状态指标
   - 下载最新 VIX 水平
   - 计算 XLK 3M、6M、12M 滚动收益率

2. **T-3 天**：分类当前状态
   - 确定波动率状态（5 级）
   - 确定市场趋势（5 级）
   - 决定配置缩放系数

3. **T-1 天**：准备交易清单
   - 计算全部 66 只股票的动量得分
   - 排名并选取前/后 20%
   - 应用配置缩放

4. **T 日（最后交易日）**：执行调仓
   - 使用 TWAP 算法执行
   - 监控滑点，对标预算（10 bps）

#### 7.3.3 风险管理框架

**止损规则：**

| 条件 | 操作 |
|------|------|
| 月度收益 < -10% | 审查配置，考虑减仓 |
| 连续 3 个月亏损 | 减仓 50% |
| VIX 日内突破 35 | 立即审查，可能暂停 |
| 与 XLK 相关性转强正 | 重新评估对冲价值 |

**仓位限制：**

| 限制类型 | 阈值 |
|---------|------|
| 单只股票权重 | 最高 5% |
| 行业集中度 | GICS 任一行业最高 30% |
| 策略总配置 | 总组合最高 25% |

#### 7.3.4 监控仪表板

**日度监控：**
- VIX 水平及 5 日移动平均
- XLK 价格与收益
- 策略盈亏 vs 基准

**周度监控：**
- 滚动收益率计算
- 状态分类状态
- 持仓多/空头审查

**月度审查：**
- 业绩归因
- 状态转换分析
- 执行成本分析

### 7.4 产品开发建议

**结构化产品选项：**

| 产品 | 结构 | 目标客户 | 费用结构 |
|------|------|---------|---------|
| 纯 Alpha | 100% 策略 | 对冲基金 | 2/20 |
| 增强 XLK | 70% XLK + 30% 策略 | 资产管理 | 0.75% 管理费 |
| 市场中性 | 多空 + 对冲 | 养老基金 | 1.5/15 |
| Smart Beta ETF | 规则化动量 | 零售 | 0.35% 费率 |

---

## 8. 可视化结果

Notebook 生成了以下交互式可视化仪表板：

### 8.1 时间序列分析仪表板（Dashboard 1）
1. **累计收益对比**：动量策略 vs XLK 基准
2. **滚动 12 个月表现**：策略和 XLK 的 12 个月滚动收益
3. **VIX 水平与波动率状态**：彩色散点图标记不同波动率状态
4. **带状态标注的月度收益**：按牛/熊市着色的月度收益柱状图

### 8.2 统计分析仪表板（Dashboard 2）
1. **波动率状态收益箱线图**
2. **市场趋势收益箱线图**
3. **风险-收益散点图**（各状态的年化收益率 vs 波动率）
4. **小提琴图**展示收益分布
5. **月度胜率**按状态分类
6. **策略与市场相关性**

### 8.3 高级热力图仪表板（Dashboard 3）
1. **年-月收益热力图**：展示策略收益的时间分布模式
2. **VIX vs 策略表现散点图**：VIX 17-23 范围内表现稳定
3. **滚动相关性分析**：12 个月滚动相关系数在 -0.4 到 +0.2 之间波动
4. **动量因子相关性矩阵**：不同方法间的相关性对比

---

## 9. 结论与未来研究方向

### 9.1 主要结论

1. **多维度状态分类**：增强型 5 级分类体系（VIX、趋势、动量、趋势强度）比传统二元方法提供更细致的市场条件评估

2. **策略选择**：风险调整动量搭配 6 个月回看期在多种市场条件下提供最佳的收益-波动平衡；3 个月回看期在绝对收益上表现最优（夏普 0.897）

3. **状态-策略整合**：动量信号与状态分类结合实现动态配置调整：
   - **低波动 + 牛市**：满仓动量配置
   - **高波动 + 任意**：减仓或对冲模式
   - **极端波动**：资本保全

4. **对冲价值**：策略在高压市场环境中表现出负 Beta，为科技板块投资者提供天然组合对冲

5. **实施可行性**：策略透明、规则化，配合适当的风险控制即可用于机构实施

6. **策略在低波动强趋势时期效果最佳**（低波动状态年化 95.15%，夏普 2.481），市场状态对策略影响显著

### 9.2 局限性

1. **测试期**：13 个月样本外测试期可能未涵盖所有市场条件，且恰好处于有利的低波动牛市环境
2. **状态样本量**：部分状态组合观察值有限，统计显著性受限
3. **交易成本**：实际执行成本可能超过 10 bps 假设，尤其对小市值成分股
4. **容量限制**：策略有效性可能在 AUM 超过 $10 亿后下降
5. **数据来源**：Yahoo Finance 数据可能因指数重构存在幸存者偏差
6. **训练期夏普为负**：提示策略在扣除无风险利率后的长期稳健性存疑，57.86% 的测试期年化收益率可能受到短期有利环境的提振

> **个人理解**：本研究最大的价值不在于策略本身的绝对收益（57.86% 的测试期年化收益率需要谨慎看待），而在于建立了一套系统性的"状态条件化分析框架"。这个框架的核心思想——策略表现是市场环境的函数，而非常数——对任何量化策略研究都具有普遍意义。此外，动量策略在不同波动率环境下的 Beta 变化（从低波动时的 ~0.5 到极端波动时的 ~-0.3）揭示了一个结构性的组合管理机会。

### 9.3 未来研究方向

1. **机器学习增强**：
   - 使用 ML 模型动态选择回看期
   - 利用额外特征预测市场状态
   - 基于注意力机制的选股

2. **多资产扩展**：
   - 将框架应用于其他行业 ETF（XLF、XLE、XLV）
   - 跨行业动量策略
   - 国际市场应用

3. **ESG 整合**：
   - ESG 筛选后的动量策略
   - 碳排放调整后的动量得分
   - 影响力感知的组合构建

4. **替代数据**：
   - 新闻/社交媒体情绪信号
   - 期权隐含波动率曲面
   - 资金流数据整合

5. **风险模型增强**：
   - 期权叠加的尾部风险对冲
   - 状态切换模型用于配置
   - 因子敞口管理

---

## 参考文献

1. Barroso, P., & Santa-Clara, P. (2015). Momentum has its moments. *Journal of Financial Economics*, *116*(1), 111–120.
2. Jegadeesh, N., & Titman, S. (1993). Returns to buying winners and selling losers: Implications for stock market efficiency. *The Journal of Finance*, *48*(1), 65–91.
3. Daniel, K., & Moskowitz, T. J. (2016). Momentum crashes. *Journal of Financial Economics*, *122*(2), 221-247.
4. Asness, C. S., Moskowitz, T. J., & Pedersen, L. H. (2013). Value and momentum everywhere. *The Journal of Finance*, *68*(3), 929-985.
5. Whaley, R. E. (2009). Understanding the VIX. *The Journal of Portfolio Management*, *35*(3), 98-105.

---

## 附录

### A. 技术实现细节

**数据管线：**
```
Yahoo Finance API → 原始数据 → 时区标准化 →
缺失值处理 → 收益率计算 → 策略回测
```

**动量得分计算（代码参考）：**
```python
def calculate_momentum_score(prices, volume, lookback_months, method):
    # 简单动量
    simple_mom = prices / prices.shift(lookback_months * 21) - 1

    if method == 'simple':
        return simple_mom
    elif method == 'risk_adjusted':
        vol = prices.pct_change().rolling(lookback_months * 21).std() * np.sqrt(252)
        return simple_mom / vol
    elif method == 'volume_weighted':
        vol_factor = volume.rolling(lookback_months * 21).mean() / volume.rolling(252).mean()
        return simple_mom * vol_factor
```

**状态分类（代码参考）：**
```python
# VIX 波动率状态
volatility_regime = pd.cut(vix_level,
    bins=[0, 15, 20, 25, 30, np.inf],
    labels=['极低波动', '低波动', '中等波动', '高波动', '极端波动'])

# 市场趋势状态（12个月收益率）
def classify_trend(xlk_12m):
    if xlk_12m > 0.20: return '强牛市'
    elif xlk_12m > 0.05: return '牛市'
    elif xlk_12m > -0.05: return '横盘'
    elif xlk_12m > -0.20: return '熊市'
    else: return '强熊市'
```

### B. XLK 成分股投资范围（66 只股票）

策略投资范围包括分析日期时的全部 XLK ETF 成分股。主要持仓包括：

| 代码 | 公司 | 板块权重 |
|------|------|---------|
| AAPL | 苹果公司 | ~20% |
| MSFT | 微软公司 | ~20% |
| NVDA | 英伟达 | ~6% |
| AVGO | 博通 | ~5% |
| ... | ... | ... |

### C. 可视化参考

Notebook 生成以下交互式可视化：

1. **累计收益图**：策略 vs XLK 基准在测试期的表现对比
2. **滚动 12 个月收益图**：时间序列对比
3. **VIX 状态叠加图**：波动率状态标记在 VIX 图表上
4. **月度收益状态图**：不同市场条件下的收益柱状图
5. **状态分布图**：各状态下的时间占比饼图
6. **策略-市场相关性**：按状态分类的热力图
7. **收益分布图**：含状态分解的直方图

### D. 术语表

| 术语 | 定义 |
|------|------|
| **动量** | 近期表现强劲的资产倾向于继续跑赢的现象 |
| **VIX** | CBOE 波动率指数，衡量预期 30 天 S&P 500 波动率 |
| **夏普比率** | 风险调整后收益指标：（收益 - 无风险利率）/ 波动率 |
| **胜率** | 正收益月份的百分比 |
| **Beta** | 衡量策略对市场波动的敏感度 |
| **回看期** | 用于动量计算的历史窗口长度 |
| **市场状态** | 基于波动率和趋势的市场条件分类 |

### E. 关键文件

- `YiboSun_Project4_26_08_V2.ipynb`：主分析 Notebook
- `adj_close.csv`：调整收盘价数据
- `volume.csv`：成交量数据

---

**免责声明**：本报告仅供研究目的，不构成投资建议。历史表现不保证未来结果。投资者应根据自身风险承受能力做出投资决策，并咨询合格的财务顾问。

**报告版本**：V2.0
**最后更新**：基于截至 2026 年 1 月的数据
**数据来源**：Yahoo Finance API（统一数据管线）
